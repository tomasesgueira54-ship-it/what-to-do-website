{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/EMPRESA/what-to-do-website/lib/schemas/subscribe.ts"],"sourcesContent":["import { z } from 'zod';\r\n\r\nexport const SubscribeSchema = z.object({\r\n    name: z.string().min(2, 'Nome é obrigatório').max(120, 'Nome muito longo'),\r\n    email: z.string().email('Email deve ser válido').min(1, 'Email é obrigatório'),\r\n    gdprConsent: z.boolean().refine((value) => value === true, {\r\n        message: 'Consentimento é obrigatório'\r\n    }),\r\n    subject: z.enum(['newsletter', 'events', 'new_episodes']).default('newsletter').optional(),\r\n    locale: z.enum(['pt', 'en']).default('pt').optional(),\r\n});\r\n\r\nexport type SubscribeInput = z.infer<typeof SubscribeSchema>;\r\n\r\nexport interface SubscribeResponse {\r\n    success: boolean;\r\n    message: string;\r\n    email?: string;\r\n    error?: string;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,kBAAkB,oLAAC,CAAC,MAAM,CAAC;IACpC,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,sBAAsB,GAAG,CAAC,KAAK;IACvD,OAAO,oLAAC,CAAC,MAAM,GAAG,KAAK,CAAC,yBAAyB,GAAG,CAAC,GAAG;IACxD,aAAa,oLAAC,CAAC,OAAO,GAAG,MAAM,CAAC,CAAC,QAAU,UAAU,MAAM;QACvD,SAAS;IACb;IACA,SAAS,oLAAC,CAAC,IAAI,CAAC;QAAC;QAAc;QAAU;KAAe,EAAE,OAAO,CAAC,cAAc,QAAQ;IACxF,QAAQ,oLAAC,CAAC,IAAI,CAAC;QAAC;QAAM;KAAK,EAAE,OAAO,CAAC,MAAM,QAAQ;AACvD"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///C:/EMPRESA/what-to-do-website/app/api/subscribe/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { Resend } from 'resend';\r\nimport { SubscribeSchema, type SubscribeResponse } from '@/lib/schemas/subscribe';\r\nimport { z } from 'zod';\r\n\r\n// In-memory storage (replace with database in production)\r\nconst subscribers = new Set<string>();\r\n\r\nexport async function POST(request: NextRequest): Promise<NextResponse<SubscribeResponse>> {\r\n    try {\r\n        const body = await request.json();\r\n\r\n        // Validate input\r\n        const validated = SubscribeSchema.parse(body);\r\n\r\n        // Apply defaults\r\n        const locale = (validated.locale || 'pt') as 'pt' | 'en';\r\n        const normalizedEmail = validated.email.trim().toLowerCase();\r\n        const normalizedName = validated.name.trim();\r\n\r\n        // Check if already subscribed\r\n        if (subscribers.has(normalizedEmail)) {\r\n            return NextResponse.json(\r\n                {\r\n                    success: false,\r\n                    message: locale === 'pt'\r\n                        ? 'Este email já está subscrito'\r\n                        : 'This email is already subscribed',\r\n                    error: 'ALREADY_SUBSCRIBED'\r\n                },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Send welcome email via Resend (if API key is available)\r\n        const apiKey = process.env.RESEND_API_KEY;\r\n        if (apiKey) {\r\n            const resend = new Resend(apiKey);\r\n\r\n            const emailSubject = {\r\n                pt: 'Bem-vindo ao What To Do!',\r\n                en: 'Welcome to What To Do!'\r\n            }[locale];\r\n\r\n            const emailBody = {\r\n                pt: `\r\n          <h2>Bem-vindo ao What To Do!</h2>\r\n      <p>Olá ${normalizedName},</p>\r\n          <p>Obrigado por te subscreveres à nossa newsletter.</p>\r\n          <p>Vais receber actualizações sobre:</p>\r\n          <ul>\r\n            <li>Eventos imperdíveis em Lisboa</li>\r\n            <li>Novos episódios do podcast</li>\r\n            <li>Guias e roteiros exclusivos</li>\r\n          </ul>\r\n          <p>Até breve!</p>\r\n          <p>What To Do Team</p>\r\n        `,\r\n                en: `\r\n          <h2>Welcome to What To Do!</h2>\r\n          <p>Hi ${normalizedName},</p>\r\n          <p>Thank you for subscribing to our newsletter.</p>\r\n          <p>You will receive updates about:</p>\r\n          <ul>\r\n            <li>Must-see events in Lisbon</li>\r\n            <li>New podcast episodes</li>\r\n            <li>Exclusive guides and itineraries</li>\r\n          </ul>\r\n          <p>See you soon!</p>\r\n          <p>What To Do Team</p>\r\n        `\r\n            }[locale];\r\n\r\n            try {\r\n                await resend.emails.send({\r\n                    from: 'noreply@whattodo.pt',\r\n                    to: normalizedEmail,\r\n                    subject: emailSubject,\r\n                    html: emailBody,\r\n                });\r\n            } catch (emailError) {\r\n                console.error('Resend email error:', emailError);\r\n                // Continue anyway - email sending failure shouldn't block subscription\r\n            }\r\n        } else {\r\n            console.warn('RESEND_API_KEY not configured. Email will not be sent.');\r\n        }\r\n\r\n        // Store subscription (in memory for now)\r\n        subscribers.add(normalizedEmail);\r\n\r\n        return NextResponse.json(\r\n            {\r\n                success: true,\r\n                message: locale === 'pt'\r\n                    ? 'Obrigado por te subscreveres!'\r\n                    : 'Thank you for subscribing!',\r\n                email: normalizedEmail\r\n            },\r\n            { status: 201 }\r\n        );\r\n    } catch (error) {\r\n        if (error instanceof z.ZodError) {\r\n            const fieldErrors = error.issues.map(issue => `${issue.path.join('.')}: ${issue.message}`).join(', ');\r\n            return NextResponse.json(\r\n                {\r\n                    success: false,\r\n                    message: 'Validation error',\r\n                    error: fieldErrors\r\n                },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        console.error('Subscribe error:', error);\r\n        return NextResponse.json(\r\n            {\r\n                success: false,\r\n                message: 'Erro ao processar subscrição. Tenta novamente.',\r\n                error: error instanceof Error ? error.message : 'Unknown error'\r\n            },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,0DAA0D;AAC1D,MAAM,cAAc,IAAI;AAEjB,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,iBAAiB;QACjB,MAAM,YAAY,gJAAe,CAAC,KAAK,CAAC;QAExC,iBAAiB;QACjB,MAAM,SAAU,UAAU,MAAM,IAAI;QACpC,MAAM,kBAAkB,UAAU,KAAK,CAAC,IAAI,GAAG,WAAW;QAC1D,MAAM,iBAAiB,UAAU,IAAI,CAAC,IAAI;QAE1C,8BAA8B;QAC9B,IAAI,YAAY,GAAG,CAAC,kBAAkB;YAClC,OAAO,gJAAY,CAAC,IAAI,CACpB;gBACI,SAAS;gBACT,SAAS,WAAW,OACd,iCACA;gBACN,OAAO;YACX,GACA;gBAAE,QAAQ;YAAI;QAEtB;QAEA,0DAA0D;QAC1D,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,IAAI,QAAQ;YACR,MAAM,SAAS,IAAI,oJAAM,CAAC;YAE1B,MAAM,eAAe;gBACjB,IAAI;gBACJ,IAAI;YACR,CAAC,CAAC,OAAO;YAET,MAAM,YAAY;gBACd,IAAI,CAAC;;aAER,EAAE,eAAe;;;;;;;;;;QAUtB,CAAC;gBACO,IAAI,CAAC;;gBAEL,EAAE,eAAe;;;;;;;;;;QAUzB,CAAC;YACG,CAAC,CAAC,OAAO;YAET,IAAI;gBACA,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC;oBACrB,MAAM;oBACN,IAAI;oBACJ,SAAS;oBACT,MAAM;gBACV;YACJ,EAAE,OAAO,YAAY;gBACjB,QAAQ,KAAK,CAAC,uBAAuB;YACrC,uEAAuE;YAC3E;QACJ,OAAO;YACH,QAAQ,IAAI,CAAC;QACjB;QAEA,yCAAyC;QACzC,YAAY,GAAG,CAAC;QAEhB,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,SAAS;YACT,SAAS,WAAW,OACd,kCACA;YACN,OAAO;QACX,GACA;YAAE,QAAQ;QAAI;IAEtB,EAAE,OAAO,OAAO;QACZ,IAAI,iBAAiB,oLAAC,CAAC,QAAQ,EAAE;YAC7B,MAAM,cAAc,MAAM,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS,GAAG,MAAM,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,MAAM,OAAO,EAAE,EAAE,IAAI,CAAC;YAChG,OAAO,gJAAY,CAAC,IAAI,CACpB;gBACI,SAAS;gBACT,SAAS;gBACT,OAAO;YACX,GACA;gBAAE,QAAQ;YAAI;QAEtB;QAEA,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,SAAS;YACT,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}